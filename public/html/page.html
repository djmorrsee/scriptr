<!DOCTYPE html>
<html>

<head>
	<script src="//code.jquery.com/jquery-1.9.1.min.js"></script>
	<meta charset="utf-8">
	<title>Scriptr</title> 
	<meta name="description" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
	<link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
	<script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<link href="css/style.css" rel="stylesheet">

</head>

<body>

		<div class="col-xs-10 col-xs-offset-1" id="main-body">
			<h1 align="center">Scriptr</h1>
		</div>

<textarea id='scriptBox' rows="30" cols="150">
</textarea>
<textarea id='scriptBox2' rows="30" cols="150">
</textarea>
</body>

<script>
	var oldVal = $(scriptBox).val();
	$(scriptBox).on('change keyup paste', function() {
		var newVal = $(scriptBox).val();
		if (newVal == oldVal) {
			return;
		}
		//console.log(newVal);
		var oldString = oldVal.split('');
		var newString = newVal.split('');

		var isDelete = false;
		
		var shortString = oldString;
		var longString = newString;

		if (oldString.length > newString.length) {
			isDelete = true
			shortString = newString;
			longString = oldString;
		}

		var i = 0;
		for (i = 0; i < shortString.length; i++) {
			if (longString[i] != shortString[i]) {
				break;
			}
		}
		var changeStart = i;
		var changeEnd = 0;
		for (var x = 0; x < longString.length; x++) {
			if (longString[longString.length-x] != shortString[shortString.length-x]) {
				changeEnd = (longString.length-x)+1;
				break;
			}
		}
		
		if (changeStart > changeEnd) {
			var temp = changeStart;
			changeStart = changeEnd;
			changeEnd = temp;
		}
		if (changeEnd == changeStart)
			changeEnd++;
			
		var finalArray = longString.slice(changeStart, changeEnd);
		var changed = finalArray.join('');
		if (finalArray[0] == " " && finalArray[finalArray.length-1] != " " && changed.charAt(0) != " ")
			changed = " " + changed;
		else if (finalArray[finalArray.length-1] == " " && finalArray[0] != " " && changed.charAt(finalArray.length-1) != " ")
			changed = changed + " ";
			
		debug (changed, changeStart, changeEnd, isDelete);
			
		receiveChange(changed, changeStart, changeEnd, isDelete);

		oldVal = newVal;
		
	});
function debug (text, start, end, isDelete) {
		if (!isDelete) {
			//document.getElementById("scriptBox2").value = "added: " + changed;
			console.log("added:" + text);
		}
		else {
			//document.getElementById("scriptBox2").value = "deleted: " + changed;
			console.log("deleted:" + text);
		}

		//console.log(changeStart);
		//console.log(changeEnd);
}
	
function receiveChange(changedString, start, end, isDelete) {
    var current = $(scriptBox2).val();
    var finalText = "";
    if (!isDelete) {
        finalText = current.slice(0, start) + changedString + current.slice(start);
    } else {
        finalText = current.slice(0, start) + current.slice(end);
    }
    document.getElementById("scriptBox2").value = finalText;
}

</script>

</html>